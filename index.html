<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Happy Buddies</title>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>

<!--    <py-env>-->
<!--        - paths:-->
<!--          - ./dates.py-->
<!--          - ./members.py-->
<!--          - ./counting_table.py-->
<!--          - ./pair_buddies.py-->
<!--    </py-env>-->
    <py-config type="json">
        {
          "packages": [],
          "paths": ["./dates.py", "./members.py", "./counting_table.py", "./pair_buddies.py"]
        }
    </py-config>

</head>
<body>
    <py-script src="dates.py"></py-script>
    <py-script src="members.py"></py-script>
    <py-script src="counting_table.py"></py-script>
    <py-script src="pair_buddies.py"></py-script>
<!--    <py-script src="./main.py"></py-script>-->
    <py-script>
    from members import Members
    from dates import Dates
    from counting_table import CountingTable
    from pair_buddies import PairBuddies

    mem = Members()
    dates = Dates()
    print("훈련 당월을 입력하세요: (1부터 12까지 최대 2개의 정수를 띄어 작성하세요. 예시: 11 12) ")
    months = list(map(int, input().split()))
    if months[0] > months[1]:
        months[0], months[1] = months[1], months[0]
    pair_buddies = PairBuddies()

    dates.set_month(months)
    dates.iniNamesInFirstMonth()
    dates.iniNamesInSecondMonth()

    cnt_table = CountingTable()
    cnt_table.initMonths(months)

    f = open("memberList.txt", "r")
    while True:
        line = f.readline()
        if not line: break
        date = line.split()[0]
        month, day = map(int, line.split()[0].split('.'))
        names = line.split()[1].split(',')

        priorities = []

        for name in names:
            priorities.append([mem.members[name][0], name])
        priorities.sort(reverse=True)

        for name in priorities:
            name = name[1]
            mem.addPossibleDateInMember(name, date)

            if month == dates.months[0]:
                dates.names_in_first_month[day - 1].append(name)
                if mem.members[name][0] <= 2:
                    cnt_table.firstMonth[day - 1][0] += 1
                else:
                    cnt_table.firstMonth[day - 1][1] += 1
            else:
                dates.names_in_second_month[day - 1].append(name)
                if mem.members[name][0] <= 2:
                    cnt_table.secondMonth[day - 1][0] += 1
                else:
                    cnt_table.secondMonth[day - 1][1] += 1

    pair_buddies.setMembers(mem)
    pair_buddies.setMonths(months)
    pair_buddies.setNamesInFirstMonth(dates.names_in_first_month)
    pair_buddies.setNamesInSecondMonth(dates.names_in_second_month)
    pair_buddies.setCntTable(cnt_table)

    pair_buddies.pairUpBuddies(cnt_table.firstMonth, dates.names_in_first_month, 0)
    pair_buddies.pairUpBuddies(cnt_table.secondMonth, dates.names_in_second_month, 1)

    pair_buddies.pairTheRest(cnt_table.firstMonth, dates.names_in_first_month, 0)
    pair_buddies.pairTheRest(cnt_table.secondMonth, dates.names_in_second_month, 1)

    # 매치된 버디 출력
    print("buddies: ")
    print(pair_buddies.getBuddies())

    # 각 회원 별 훈련 날짜 수
    print("\n")
    print("각 회원이 " + str(months[0]) + "월과 " + str(months[1]) + "월에 훈련을 받는 횟수: ")
    for member, values in cnt_table.membersInCntTable.items():
        print(member, values, end=" ")
        # # calendar: https://www.tutorialspoint.com/how-to-handle-a-button-click-event-in-tkinter
        # # dynamic button: https://pythonexamples.org/python-tkinter-change-button-text-dynamically/
        # # StringVar() 을 담은 변수의 이름은 반드시 str 이어야 하나보다. => 아님.
        # # 2차원 배열의 포함여부 검사하기: https://velog.io/@woo0_hooo/python-2차원-리스트에서-원소의-포함여부-검사하기
        # # textbox 에서 글 색상 바꾸기: https://stackoverflow.com/questions/47591967/changing-the-colour-of-text-automatically-inserted-into-tkinter-widget


    </py-script>
<!--    <py-env>-->
<!--            - tkinter-->
<!--        - paths:-->
<!--            - ./dates.py-->
<!--            - ./members.py-->
<!--            - ./counting_table.py-->
<!--            - ./pair_buddies.py-->
<!--            - ./main.py-->
<!--    </py-env>-->
<!--    <py-script type="py" src="./members.py" config="./lib/pyscript.json"></py-script>-->
<!--    <py-script type="py" src="./dates.py" config="./lib/pyscript.json"></py-script>-->
<!--    <py-script type="py" src="./counting_table.py" config="./lib/pyscript.json"></py-script>-->
<!--    <py-script type="py" src="./pair_buddies.py" config="./lib/pyscript.json"></py-script>-->
<!--    <py-script type="mpy" src="./main.py" config="./lib/pyscript.json"></py-script>-->
</body>
</html>
